<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>X+培训机构约课系统 - 添加会员</title>
    <meta name="keywords" content="后台bootstrap框架,会员中心主题,后台HTML,响应式后台">
    <meta name="description" content="完全响应式，基于Bootstrap3最新版本开发的扁平化主题，她采用了主流的左右两栏式布局，使用了Html5+CSS3等现代技术">

    <link rel="shortcut icon" href="../../static/favicon.ico" th:href="@{/static/favicon.ico}">
    <link href="../../static/css/bootstrap.min.css?v=3.3.6" th:href="@{/static/css/bootstrap.min.css(v='3.3.6')}" rel="stylesheet">
    <link href="../../static/css/font-awesome.css?v=4.4.0" th:href="@{/static/css/font-awesome.css(v='4.4.0')}" rel="stylesheet">
    <link href="../../static/css/animate.css" th:href="@{/static/css/animate.css}" rel="stylesheet">
    <link href="../../static/css/style.css?v=4.1.0" th:href="@{/static/css/style.css(v='4.1.0')}" rel="stylesheet">

    <!-- bootstrap-datepicker -->
    <link href="../../static/css/plugins/datapicker/bootstrap-datepicker.css" th:href="@{/static/css/plugins/datapicker/bootstrap-datepicker.css}" rel="stylesheet">

    <style type="text/css">
        .img-circle {
            height: 30px;
            width: 30px;
        }

        .img_line {
            width: 20%;
        }

        .input_style {
            background-color: #FFFFFF;
            border: 1px solid #e5e6e7;
            border-radius: 1px;
            padding: 6px 12px;
            font-size: 14px;
            transition: border-color 0.15s ease-in-out 0s, box-shadow 0.15s ease-in-out 0s;
        }

        .input_style:focus {
            border-color: #1ab394 !important;
        }
    </style>

</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content" style="height: 120px">
                    <div class="col-md-12 col-md-offset-2" style="padding: 30px">
                        <img src="../../static/img/x_member_add_1.png" th:src="@{/static/img/x_member_add_1.png}" alt="会员信息" class="img-circle">
                        <label>会员信息</label>
                        <img src="../../static/img/x_member_add_4_1.png" th:src="@{/static/img/x_member_add_4_1.png}" alt="线条" class="img_line">

                        <img src="../../static/img/x_member_add_2_1.png" th:src="@{/static/img/x_member_add_2_1.png}" alt="绑定会员卡" class="img-circle">
                        <label>绑定会员卡</label>
                        <img src="../../static/img/x_member_add_4_1.png" th:src="@{/static/img/x_member_add_4_1.png}" alt="线条" class="img_line">

                        <img src="../../static/img/x_member_add_3_1.png" th:src="@{/static/img/x_member_add_3_1.png}" alt="完成" class="img-circle">
                        <label>完成</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content add" style="">
                    <form id="addForm" method="post" class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="text-danger">*</span>
                                会员姓名</label>
                            <div class="col-sm-8">
                                <input name="name" type="text" class="form-control" placeholder="会员姓名">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="text-danger">*</span>
                                手机号</label>
                            <div class="col-sm-8">
                                <input name="phone" type="text" class="form-control" placeholder="手机号">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                <span class="text-danger">*</span>
                                性别</label>
                            <div class="col-sm-8">
                                <label class="control-label">
                                    <input type="radio" checked="checked" value="男" name="sex">
                                    <span>男</span>
                                </label>&nbsp;&nbsp;

                                <label class="control-label">
                                    <input type="radio" value="女" name="sex">
                                    <span>女</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                出生日期</label>
                            <div class="col-sm-3">
                                <input name="birthday" type="date" id="myDate" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">
                                备注</label>
                            <div class="col-sm-8">
                                <textarea name="note" class="col-sm-12 form-control" rows="5" placeholder="会员备注信息..."></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-8 col-sm-offset-2">
                                <p name="save_info" class="btn btn-success" >保存,为该会员绑定会员卡</p>
                                <p name="save_info" class="btn btn-white" >保存会员信息,暂不绑定会员卡</p>
                                <p class="btn btn-white" type="reset">取消</p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="ibox-content binding" style="display: none">
                    <form id="bindForm" class="form-horizontal">
						<!-- 功能冗余 -->
                        <!-- <div class="form-group">
                            <label class="col-md-2 control-label" style="margin-bottom: 20px">会员</label>
                            <div class="col-md-8">
                                <input class="form-control" placeholder="输入名字或者手机号搜索" type="text">
                            </div>
                        </div> -->
                        <div class="form-group">
                            <label class="col-md-2 control-label" style="margin-bottom: 30px">选择会员卡</label>
                            <!-- 隐藏域，保存会员id -->
                            <input type="hidden" name="memberId" />
                            <div class="col-md-8">
                                <select class="form-control" id="selectList" name="cardId">
                                   <option value = "">--请选择绑定的会员卡--</option>
                                </select>
                            </div>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label class="col-md-2 control-label">充值次数</label>
                            <div class="col-md-10">
								<input type="number" class="input_style" name="validCount" value="50" min="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-2 control-label">有效期</label>
                            <div class="col-md-10">
								<input type="number" class="input_style" name="validDay" value="30" min="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-2 control-label">实收金额</label>
                            <div class="col-md-2">
                                <div class="input-group">
                                    <div class="input-group-addon">￥</div>
                                    <input type="text" name="receivedMoney" class="form-control"  placeholder="金额" min="0">
                                    <div class="input-group-addon">元</div>
                                </div>

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-2 control-label">选择支付方式</label>
                            <div class="col-md-8">
                                <select class="form-control" name="payMode" id="payList">
                                    <option value = "">--请选择--</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-2 control-label">备注</label>
                            <div class="col-md-8">
                                <textarea class="form-control" rows="3" name="note"></textarea>
                            </div>
                        </div>
                        <button id="bind_confirm" type="button" class="btn btn-danger col-md-offset-2 control-label">确认</button>
                        <button type="button" class="btn btn-primary">取消</button>
                    </form>
                </div>
                <div class="ibox-content complete" style="display: none">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <div class="col-md-8 col-md-offset-2">
                                <div class="jumbotron">
                                    <h1>会员注册成功！</h1>
                                    <p></p>
                                    <p><a class="btn btn-primary btn-lg" href="#" th:href="@{/member/x_member_list.do}">点我回到会员页</a></p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 全局js -->
<script src="../../static/js/jquery.min.js?v=2.1.4" th:src="@{/static/js/jquery.min.js(v='2.1.4')}"></script>
<script src="../../static/js/bootstrap.min.js?v=3.3.6" th:src="@{/static/js/bootstrap.min.js(v='3.3.6')}"></script>

<!-- 自定义js -->
<script src="../../static/js/content.js?v=1.0.0" th:src="@{/static/js/content.js(v='1.0.0')}"></script>

<!-- Peity -->
<script src="../../static/js/plugins/peity/jquery.peity.min.js" th:src="@{/static/js/plugins/peity/jquery.peity.min.js}"></script>

<script type="text/javascript" src="http://tajs.qq.com/stats?sId=9051096" charset="UTF-8"></script>
<!--统计代码，可删除-->

<!-- Data picker -->
<script src="../../static/js/plugins/datapicker/bootstrap-datepicker.js" th:src="@{/static/js/plugins/datapicker/bootstrap-datepicker.js}"></script>
<script src="../../static/js/plugins/datapicker/bootstrap-datepicker.zh-CN.min.js" th:src="@{/static/js/plugins/datapicker/bootstrap-datepicker.zh-CN.min.js}"></script>
<script>
    $(function () {
        /*时间控件配置*/
        $('#myDate').datepicker({
            language: "zh-CN",
            clearBtn: true,//清除
            autoclose: true,
            todayHighlight: true,
            format: 'yyyy-mm-dd',
            todayBtn: false,//今日按钮
            startDate: '1970-1-1', //与你自己设置的格式一致yyyy-mm-dd，未设置的话与默认格式一致mm/dd/yyyy
            endDate: '2070-1-1'
        });

        /*======== 获取表单数据  =========*/
        
        /* 获取表单数据 - 添加会员 */
        var formAdd = "";
        $("p[name='save_info']").on("mouseenter",function(){
    		formAdd = $("#addForm").serialize();
    		console.log(formAdd);
        });
        /* 获取表单数据 - 会员绑卡 */
        var formBind = "";
        $("#bind_confirm").on("mouseenter",function(){
        	formBind = $("#bindForm").serialize();
    		console.log(formBind);
        });
        
        
        /*======== 下拉列表填充数据  =========*/
        
     	/* 填充下拉列表 - 会员卡 */
    	var cardListSave = "";
    	$.post("[[${#request.getContextPath()}]]/card/cardList.do",function(cardList){
    		cardListSave = cardList;
			for(var i = 0; i < cardList.length; i++){
				$("#selectList").append("<option  value='"+ cardList[i].id +"'>"+ cardList[i].name +"</option>");
			}
			
		});
    	
    	/* 选中的列表项 - 会员卡 */
		$("#selectList").change(function(){
			var selectOne = $(this).val();
			for(var i = 0; i < cardListSave.length; i++){
				$("option[value='"+ cardListSave[i].id +"']").attr("selected","");
				if(selectOne == cardListSave[i].id){
					$("option[value='"+ selectOne +"']").attr("selected","selected");	        						        							
				}
			}
		});
    	
    	/* 填充下拉列表 - 支付方式 */
    	//var payListSave = "";
    	/* $.get("json-data/payMode.json",function(payList){
    		payListSave = payList;
			for(var i = 0; i < payList.length; i++){
				$("#payList").append("<option  value='"+ payList[i].id +"'>"+ payList[i].name +"</option>");
			}
			
		},"json"); */
	    var	payListSave = [
			{"id": 1, "name": "现金"},
			{"id": 2, "name": "支付宝"},
			{"id": 3, "name": "微信"},
			{"id": 4, "name": "银行卡"}
		];
		var payList = payListSave;
	    for(var i = 0; i < payList.length; i++){
			$("#payList").append("<option  value='"+ payList[i].name +"'>"+ payList[i].name +"</option>");
		}			
			
    	/* 选中的列表项 - 支付方式 */
		$("#payList").change(function(){
			var selectOne = $(this).val();
			for(var i = 0; i < payListSave.length; i++){
				$("option[value='"+ payListSave[i].name +"']").attr("selected","");
				if(selectOne == payListSave[i].name){
					$("option[value='"+ selectOne +"']").attr("selected","selected");	        						        							
				}
			}
			console.log("pay: " + selectOne);
		});    	
        
    	
    	/*===========表单数据提交===========*/
    	
        /* 保存会员信息,绑定会员卡 */
        $('.btn.btn-success').click(function () {
        	//添加会员检验
        	$.post("[[${#request.getContextPath()}]]/member/memberAdd.do",formAdd,function(memberMsg){
	        	//移除重复提示 - 会员添加
	        	$("input[name='phone']").nextAll().remove();
        		if (memberMsg.version == 4) {
        			//保存刚录入的用户id
        			console.log($("input[name='memberId']").val(memberMsg.id));
		            $('.ibox-content.add').css('display', 'none');
		            $('.ibox-content.binding').css('display', 'block');
		            $('.img_line:first').attr('src', '../static/img/x_member_add_4_2.png');
		            $('img:nth-child(4)').attr('src', '../static/img/x_member_add_2_2.png');
		            /* 绑定会员卡确认 */
		            $('.btn.btn-danger.col-md-offset-2.control-label').click(function () {
		            	$.post("[[${#request.getContextPath()}]]/cardBind/memberBind.do",formBind,function(bindMsg){
				            //移除重复提示 - 绑卡
				            $("#selectList").nextAll().remove();
		            		if(bindMsg.version == 4){
		            			//页面跳转
		            			$('.ibox-content.binding').css('display', 'none');
				                $('.ibox-content.complete').css('display', 'block');
				                $('img:nth-child(6)').attr('src', '../static/img/x_member_add_4_2.png');
				                $('img:nth-child(7)').attr('src', '../static/img/x_member_add_3_2.png');
		            		}else{
		            			$("#selectList").after("<span class='text-danger'>"+ bindMsg.note +"</span>");
		            		}
		            	});
		            });
        		}else{
					$("input[name='phone']").after("<span class='text-danger'>"+ memberMsg.note +"</span>");
				}
        	});
            
        });
        /* 保存会员信息,暂不绑定会员卡 */
        $('.btn.btn-white:nth-child(2)').click(function () {
        	//请求数据
            $.ajax({
            	url: "[[${#request.getContextPath()}]]/member/memberAdd.do",
            	type: "post",
            	data: formAdd,
            	success: function(memberMsg){
		        	//移除重复提示
		        	$("input[name='phone']").nextAll().remove();
            		if (memberMsg.version == 4) {
   				        //页面跳转
	   				    $('.ibox-content.add').css('display', 'none');
	                    $('.ibox-content.complete').css('display', 'block');
	                    $('.img_line:first').attr('src', '../static/img/x_member_add_4_2.png');
	                    $('img:nth-child(4)').attr('src', '../static/img/x_member_add_2_2.png');
	                    $('img:nth-child(6)').attr('src', '../static/img/x_member_add_4_2.png');
	                    $('img:nth-child(7)').attr('src', '../static/img/x_member_add_3_2.png');
   				    }else{
   				    	$("input[name='phone']").after("<span class='text-danger'>"+ memberMsg.note +"</span>");
   					}
            	},
            	error: function(){
            		alert("添加失败");
            		window.location.reload();
            	}
            });
            
        });
        
    });
</script>

<!-- Image cropper -->
<script src="../../static/js/plugins/cropper/cropper.min.js" th:src="@{/static/js/plugins/cropper/cropper.min.js}"></script>

</body>

</html>
