<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kclm.xsap.dao.ClassRecordDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.kclm.xsap.entity.ClassRecordEntity" id="classRecordMap">
        <result property="id" column="id"/>
        <result property="memberId" column="member_id"/>
        <result property="cardName" column="card_name"/>
        <result property="scheduleId" column="schedule_id"/>
        <result property="note" column="note"/>
        <result property="comment" column="comment"/>
        <result property="checkStatus" column="check_status"/>
        <result property="reserveCheck" column="reserve_check"/>
        <result property="createTime" column="create_time"/>
        <result property="lastModifyTime" column="last_modify_time"/>
        <result property="version" column="version"/>
    </resultMap>


    <resultMap id="getClassRecord" type="com.kclm.xsap.vo.ClassRecordVo">
        <id column="id" property="classRecordId"/>
        <result column="card_name" property="cardName"/>
        <result column="times_cost" property="timesCost"/>
        <result column="money_cost" property="involveMoney"/>
        <result column="create_time" property="createTimes"/>
        <result column="last_modify_time" property="operateTime"/>
        <result column="check_status" property="checkStatus"/>
        <result column="start_date" property="startDate"/>
        <result column="class_time" property="classTime"/>
        <result column="card_id" property="cardId"/>

        <result column="mid" property="memberId"/>
        <result column="mname" property="memberName"/>
        <result column="mphone" property="memberPhone"/>
        <result column="msex" property="memberSex"/>
        <result column="mbirthday" property="memberBirthday"/>

        <!--todo 修改属性名-->
        <!--<association property="member" javaType="com.kclm.xsap.entity.MemberEntity">
            <id column="mid" property="id"/>
            <result column="name" property="name"/>
            <result column="phone" property="phone"/>
            <result column="sex" property="sex"/>
            <result column="birthday" property="birthday"/>
        </association>-->

    </resultMap>


    <!--    <select id="selectClassRecordList" resultType="com.kclm.xsap.vo.ClassRecordVo">-->
    <select id="selectClassRecordList" resultMap="getClassRecord">

        select tcr.id,
               tm.id       mid,
               tm.name     mname,
               tm.phone    mphone,
               tcr.card_name,
               tm.sex      msex,
               tm.birthday mbirthday,
#        tcre.card_count_change,
#        tcre.money_cost,
               tc.times_cost,
               tcr.create_time,
               tcr.last_modify_time,
               tcr.check_status,
               tsr.start_date,
               tsr.class_time,
               trr.card_id
        from t_class_record tcr
                 left join t_member tm on tcr.member_id = tm.id
                 left join t_schedule_record tsr on tcr.schedule_id = tsr.id
                 left join t_course tc on tsr.course_id = tc.id
                 left join t_reservation_record trr on tm.id = trr.member_id and tsr.id = trr.schedule_id
        where
        tcr.schedule_id = #{id};

    </select>


    <resultMap id="memberClassInfo" type="com.kclm.xsap.vo.ClassInfoVo">
        <id property="classRecordId" column="classId"/>
        <result property="courseName" column="courseName"/>
        <result property="scheduleStartDate" column="scheduleStartDate"/>
        <result property="scheduleStartTime" column="scheduleStartTime"/>
        <result property="teacherName" column="employeeName"/>
        <result property="cardName" column="classCardName"/>
        <result property="classNumbers" column="SingleReserveNums"/>
        <result property="timesCost" column="courseTimeCost"/>
        <result property="checkStatus" column="classCheckStatus"/>
    </resultMap>
    <select id="selectClassInfo" resultMap="memberClassInfo">
        select tcr.id           classId,
               tc.name          courseName,
               tsr.start_date   scheduleStartDate,
               tsr.class_time   scheduleStartTime,
               te.name          employeeName,
               tcr.card_name    classCardName,
               trr.reserve_nums SingleReserveNums,
               tc.times_cost    courseTimeCost,
               tcr.comment      classComment,
               tcr.check_status classCheckStatus
        from t_class_record tcr,
             t_schedule_record tsr,
             t_course tc,
             t_employee te,
             t_reservation_record trr
        where tcr.schedule_id = tsr.id
          and tsr.course_id = tc.id
          and tsr.teacher_id = te.id
          and trr.schedule_id = tsr.id
          and tcr.member_id = #{id}
    </select>


</mapper>